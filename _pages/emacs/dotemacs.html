---
layout: page
title: 'GNU Emacs configuration'
excerpt: "Protesilaos Stavrou's customisations for Emacs.  These contribute to a consistent computing experience on top of GNU/Linux."
permalink: /emacs/dotemacs
redirect_from:
  - /dotemacs
---

<p>
This page is a work-in-progress.  I started it on 2023-05-24 as a
successor to my old Emacs literate configuration file.
</p>

<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#h:23952262-063e-4c3b-a8af-4fd67d91c2d5">1. About this page</a></li>
<li><a href="#h:103d6f5a-bdb1-4b49-946a-708a83c79a7d">2. Anatomy of my Emacs configuration</a></li>
</ul>
</div>
</div>

<div id="outline-container-h:23952262-063e-4c3b-a8af-4fd67d91c2d5" class="outline-2">
<h2 id="h:23952262-063e-4c3b-a8af-4fd67d91c2d5"><span class="section-number-2">1.</span> About this page</h2>
<div class="outline-text-2" id="text-h:23952262-063e-4c3b-a8af-4fd67d91c2d5">
<p>
Herein you will find documentation about my  files for
Emacs.  <b>This is not a literate configuration</b>: it is ordinary Emacs
Lisp code that I am writing about in a separate file.
</p>

<ul class="org-ul">
<li>Website: <a href="https://protesilaos.com/emacs/dotemacs">https://protesilaos.com/emacs/dotemacs</a></li>
<li>Git repo on SourceHut: <a href="https://git.sr.ht/~protesilaos/dotfiles">https://git.sr.ht/~protesilaos/dotfiles</a>
<ul class="org-ul">
<li>Mirrors:
<ul class="org-ul">
<li>GitHub: <a href="https://github.com/protesilaos/dotfiles">https://github.com/protesilaos/dotfiles</a></li>
<li>GitLab: <a href="https://gitlab.com/protesilaos/dotfiles">https://gitlab.com/protesilaos/dotfiles</a></li>
</ul></li>
</ul></li>
<li>Mailing list: <a href="https://lists.sr.ht/~protesilaos/dotfiles">https://lists.sr.ht/~protesilaos/dotfiles</a></li>
<li>Backronym: Do Observe, Transpose, Examine, or Mirror All
Configurations, Stranger</li>
</ul>
</div>
</div>

<div id="outline-container-h:103d6f5a-bdb1-4b49-946a-708a83c79a7d" class="outline-2">
<h2 id="h:103d6f5a-bdb1-4b49-946a-708a83c79a7d"><span class="section-number-2">2.</span> Anatomy of my Emacs configuration</h2>
<div class="outline-text-2" id="text-h:103d6f5a-bdb1-4b49-946a-708a83c79a7d">
<p>
I have built my setup from scratch and am observing best practices
with regard to how Emacs expects things to run.  I do not use the
Emacs daemon, as I have encountered instabilities with it.  Instead, I
run a single instance, that I launch at startup, and then configure it
to act as the server.  This means that I can still connect to the
running session via <code>emacsclient</code>, which is useful when I want to
evaluate Elisp code from outside of Emacs (e.g. with the <code>delight</code>
shell script that switches the entire &ldquo;environment&rdquo; theme of my tiling
window manager&#x2014;see my dotfiles for the technicalities).
</p>

<p>
With those granted, here is an overview of how files are organised and
what they do:
</p>

<dl class="org-dl">
<dt>The <code>early-init.el</code> file</dt><dd>This is the first file that Emacs reads
when starting up.  It should contain code that does not depend on
any package or the proportions of the Emacs frame.  My <code>early-init.el</code>
is the place where I:

<ul class="org-ul">
<li>Set up the parameters of the initial and all future frames.</li>

<li>Make the <code>custom-file</code> disposable because I consider persistent
configurations outside my hand-written code to be highly
problematic.</li>

<li>Optimise the early initialisation phase to speed up startup time.</li>

<li>Define functions that test whether my environment is using a light
or dark theme.  Those are used by my Emacs theme-related
configurations, to load an appropriate theme.</li>

<li>Prevent the initial flash of light if my environment theme is dark
when I launch Emacs.</li>
</ul></dd>

<dt>The <code>init.el</code> file</dt><dd>This is the main configuration file that Emacs
uses.  Mine defines some user options that are intended for the
<code>prot-emacs-pre-custom.el</code> file (more below) and then goes on to
handle the substantive parts of my configuration.  Concretely:

<ul class="org-ul">
<li>Registers my <code>prot-lisp/</code> and <code>prot-emacs-modules/</code> in the Emacs
<code>load-path</code>.  Read further below for what these are.</li>

<li>Arranges my package archives and ensures that the packages I
develop are drawn from the <code>elpa-devel</code> archive.  Read here for
all my packages: <a href="https://protesilaos.com/emacs">https://protesilaos.com/emacs</a>.</li>

<li>Defines the Lisp Macros that are used throughout my setup, such as
<code>prot-emacs-package</code> and <code>prot-emacs-keybind</code>.  Why not
<code>use-package</code>, especially now that it is built into Emacs?
Because (i) I do not like many aspects of its behaviour, such as
key bindings &ldquo;magically&rdquo; delaying the load of a package, and (ii)
I have no use for most of its functionality.</li>

<li>Loads all the modules of my setup in the appropriate order.</li>
</ul></dd>

<dt>The <code>prot-emacs-modules</code> directory</dt><dd>This is where I store all the
individual components of my Emacs setup.  The directory resides as a
subdirectory of <code>~/.emacs.d/</code>.  All files are prefixed with
<code>prot-emacs-</code>, followed by a word that broadly describes their scope
of application, such as <code>prot-emacs-font</code>, <code>prot-emacs-window</code>&#x2026;
Each module consists of ordinary Elisp and a final call to <code>provide</code>
the set of configurations as a <i>feature</i> that can then be loaded via
<code>require</code> from the <code>init.el</code>.  What Emacs calls a &ldquo;feature&rdquo; is, in
essence a variable whose value is the entirety of the file that has
a <code>provide</code> call to it.  Features are symbols that are named after
the file name minus its file type extension: <code>prot-emacs-font</code> is
the feature provided by <code>prot-emacs-font.el</code>.</dd>

<dt>The <code>prot-lisp</code> directory</dt><dd>As with the aforementioned modules,
this directory is a subdirectory of <code>~/.emacs.d/</code>.  This is where I
keep all my custom code that individual modules can use.  The
contents of this directory can be understood as &ldquo;packages&rdquo; and, in
fact, many of my actual packages started out as <code>prot-lisp</code>
experiments.  Each file is written in accordance with the
conventions on Emacs packaging, even though they are only intended
for use in my setup and are not polished to the level of my actual
public-facing packages (meaning the one listed here:
<a href="https://protesilaos.com/emacs">https://protesilaos.com/emacs</a>).</dd>

<dt>The <code>prot-emacs-pre-custom</code> file</dt><dd>It is evaluated before the
modules are loaded.  It is intended for users of my configuration
who want to:

<ul class="org-ul">
<li>Specify their preferred theme family by setting the user option
<code>prot-emacs-load-theme-family</code>.</li>

<li>Choose a completion framework of their choice by configuring
<code>prot-emacs-completion-ui</code>.</li>

<li>Opt to omit packages from being loaded by the <code>init.el</code> and its
modules, by defining the value of <code>prot-emacs-omit-packages</code>.</li>
</ul></dd>

<dt>The <code>prot-emacs-post-custom</code> file</dt><dd>Like the above, this file is
meant for users of my setup.  It is evaluated <i>after</i> the rest of my
setup is loaded.  Here they can include whatever code they want.</dd>

<dt>The <code>prot-emacs.org</code> file</dt><dd>The source of what you are currently
reading.  It is not pertinent to the configuration of Emacs.  All it
does is to document the rest of my code.</dd>
</dl>
</div>
</div>
