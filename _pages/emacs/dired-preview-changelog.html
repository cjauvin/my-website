---
layout: page
title: 'Change Log of Dired Preview'
subtitle: 'Automatically preview files in Dired'
excerpt: "dired-preview is a simple and robust package to automatically preview in a side window the file at point in Dired buffers."
permalink: /emacs/dired-preview-changelog
---

<p>
This document contains the release notes for each tagged commit on the
project's main git repository: <a href="https://github.com/protesilaos/dired-preview">https://github.com/protesilaos/dired-preview</a>.
</p>

<p>
The newest release is at the top.  For further details, please consult
the manual: <a href="https://protesilaos.com/emacs/dired-preview">https://protesilaos.com/emacs/dired-preview</a>.
</p>

<div id="outline-container-h:4225d638-f5bb-4855-85c7-972ff40aad6d" class="outline-2">
<h2 id="h:4225d638-f5bb-4855-85c7-972ff40aad6d">0.2.0 on 2024-05-07</h2>
<div class="outline-text-2" id="text-h:4225d638-f5bb-4855-85c7-972ff40aad6d">
<p>
This release brings many small improvements and fixes some bugs.
</p>
</div>

<div id="outline-container-h:e3652b69-aa81-4b71-9887-81052ff7f9f7" class="outline-3">
<h3 id="h:e3652b69-aa81-4b71-9887-81052ff7f9f7">The preview shows up right away on new directories</h3>
<div class="outline-text-3" id="text-h:e3652b69-aa81-4b71-9887-81052ff7f9f7">
<p>
In the past, entering a new directory would not trigger a preview: it
would wait for some motion before doing so. This could make it seem
that the mode was not enabled in the current buffer. Now, the preview
shows up immediately.
</p>

<p>
Thanks to Nofint for the initial contribution in pull request 8:
<a href="https://github.com/protesilaos/dired-preview/pull/8">https://github.com/protesilaos/dired-preview/pull/8</a>. The changes are
small and do not require copyright assignment to the Free Software
Foundation.
</p>
</div>
</div>

<div id="outline-container-h:8dae8cba-3ca7-43be-a4ba-5dd938b37f82" class="outline-3">
<h3 id="h:8dae8cba-3ca7-43be-a4ba-5dd938b37f82">Directories are previewed as well</h3>
<div class="outline-text-3" id="text-h:8dae8cba-3ca7-43be-a4ba-5dd938b37f82">
<p>
The contents are displayed in a Dired buffer, using the current
settings for it. This means that colours are possible icons are shown
too.
</p>
</div>
</div>

<div id="outline-container-h:b4928def-5392-4e7b-8cb5-ed5c238b1b5e" class="outline-3">
<h3 id="h:b4928def-5392-4e7b-8cb5-ed5c238b1b5e">Large files are previewed in <code>hexl-mode</code></h3>
<div class="outline-text-3" id="text-h:b4928def-5392-4e7b-8cb5-ed5c238b1b5e">
<p>
As the documentation of this mode suggests:
</p>

<blockquote>
<p>
A mode for editing binary files in hex dump format.
This is not an ordinary major mode; it alters some aspects
of the current modeâ€™s behavior, but not all; also, you can exit
Hexl mode and return to the previous mode using C-c C-c.
</p>
</blockquote>

<p>
The <code>C-c C-c</code> key binding toggles the mode, in case you want to see
the raw output.
</p>

<p>
Thanks to Karthik Chikmagalur for the contribution. This was done on
the now defunct mailing list:
<a href="https://lists.sr.ht/~protesilaos/general-issues/%3C871qeb56bw.fsf@gmail.com%3E">https://lists.sr.ht/~protesilaos/general-issues/%3C871qeb56bw.fsf@gmail.com%3E</a>.
</p>
</div>
</div>

<div id="outline-container-h:ea324fd1-f808-420f-b019-250e161465ff" class="outline-3">
<h3 id="h:ea324fd1-f808-420f-b019-250e161465ff">Previews are displayed in a full-featured mode</h3>
<div class="outline-text-3" id="text-h:ea324fd1-f808-420f-b019-250e161465ff">
<p>
Before, we would delay the execution of the mode hooks to speed things
up. Though this came at the cost of (i) making the buffer less capable
and (ii) forcing us to handle the execution of those hooks at a later
stage when they would be needed, which proved to be error-prone in a
number of scenaria.
</p>
</div>
</div>

<div id="outline-container-h:a4d6b125-5ef6-409d-aded-e7b1971ac87d" class="outline-3">
<h3 id="h:a4d6b125-5ef6-409d-aded-e7b1971ac87d">Files without an extension are still previewed</h3>
<div class="outline-text-3" id="text-h:a4d6b125-5ef6-409d-aded-e7b1971ac87d">
<p>
This is a bug fix. Before, they would be considered as part of the
files to be ignored, per <code>dired-preview-ignored-extensions-regexp</code>.
</p>
</div>
</div>

<div id="outline-container-h:67d61ed2-3e16-49a9-bd3a-61950d9ab81b" class="outline-3">
<h3 id="h:67d61ed2-3e16-49a9-bd3a-61950d9ab81b">Previews are not added to what <code>recentf-mode</code> tracks</h3>
<div class="outline-text-3" id="text-h:67d61ed2-3e16-49a9-bd3a-61950d9ab81b">
<p>
Thanks to Juergen Hoetzel for reporting this issue and for tweaking my
suggested patch for it. This was done in pull request 12:
<a href="https://github.com/protesilaos/dired-preview/pull/12">https://github.com/protesilaos/dired-preview/pull/12</a>. The change is
small, so Juergen does not need to assign copyright to the Free
Software Foundation.
</p>
</div>
</div>

<div id="outline-container-h:493488b1-0f7d-4b44-b96d-4cd9a6bde352" class="outline-3">
<h3 id="h:493488b1-0f7d-4b44-b96d-4cd9a6bde352">A nil value for <code>split-width-threshold</code> still works</h3>
<div class="outline-text-3" id="text-h:493488b1-0f7d-4b44-b96d-4cd9a6bde352">
<p>
We no longer consider this an error and adapt the preview accordingly.
Thanks to Juergen Hoetzel for the contribution. This was done in pull
request 11 and does not require copyright assignment:
<a href="https://github.com/protesilaos/dired-preview/pull/11">https://github.com/protesilaos/dired-preview/pull/11</a>.
</p>
</div>
</div>

<div id="outline-container-h:d8c42eea-a540-44fd-91b4-138fdba47288" class="outline-3">
<h3 id="h:d8c42eea-a540-44fd-91b4-138fdba47288">For developers: previews are done with <code>cl-defmethod</code></h3>
<div class="outline-text-3" id="text-h:d8c42eea-a540-44fd-91b4-138fdba47288">
<p>
Each file type will thus have its own method on how to display the
contents in a buffer. The idea is to make this easier to extend. The
goal is to have methods that can preview PDFs and images without
blocking Emacs. Other file types can be considered as well, though
those two are the immediate priority.
</p>
</div>
</div>
</div>

<div id="outline-container-h:99cbb3dd-a0f1-4d2b-a945-58531f4ab189" class="outline-2">
<h2 id="h:99cbb3dd-a0f1-4d2b-a945-58531f4ab189">0.1.0 on 2023-07-08</h2>
<div class="outline-text-2" id="text-h:99cbb3dd-a0f1-4d2b-a945-58531f4ab189">
<p>
The <code>dired-preview</code> package was in a public testing phase from
2023-06-25 until today.  In the meantime, lots of changes have been
made in the interest of usability and robustness.
</p>
</div>

<div id="outline-container-h:598de101-5c1f-4fbd-8f27-709375d8950b" class="outline-3">
<h3 id="h:598de101-5c1f-4fbd-8f27-709375d8950b">Global and buffer-local modes</h3>
<div class="outline-text-3" id="text-h:598de101-5c1f-4fbd-8f27-709375d8950b">
<p>
The <code>dired-preview-mode</code> is a local minor mode, while
<code>dired-preview-global-mode</code> is its global counterpart.  Both only take
effect in Dired buffers.
</p>

<p>
The idea for a global and a local mode is to empower the user to
toggle the functionality on demand, such as when they are in a meeting
and want to disable/enable previews in a given context.
</p>

<p>
During the development phase, I had made an error regarding the scope
of what should be a local minor mode.  Thanks to Christian Tietze for
pointing it out: <a href="https://lists.sr.ht/~protesilaos/general-issues/%3Cm1zg4noej2.fsf%40christiantietze.de%3E">https://lists.sr.ht/~protesilaos/general-issues/%3Cm1zg4noej2.fsf%40christiantietze.de%3E</a>.
</p>
</div>
</div>

<div id="outline-container-h:b80cc550-24ee-4817-be8c-c24c5e98e4c2" class="outline-3">
<h3 id="h:b80cc550-24ee-4817-be8c-c24c5e98e4c2">Preview delay runs on an idle timer</h3>
<div class="outline-text-3" id="text-h:b80cc550-24ee-4817-be8c-c24c5e98e4c2">
<p>
Originally, previews would run on a timer that would block Emacs.
Whereas we now arrange to only trigger a preview when Emacs is idle
for a customisable amount of seconds.  Refer to the user option
<code>dired-preview-delay</code>.
</p>
</div>
</div>

<div id="outline-container-h:c298121a-5ba4-408b-b063-14022c307c47" class="outline-3">
<h3 id="h:c298121a-5ba4-408b-b063-14022c307c47">Trigger a preview in the post-command phase</h3>
<div class="outline-text-3" id="text-h:c298121a-5ba4-408b-b063-14022c307c47">
<p>
In the original design, previews were triggered by bespoke
<code>dired-preview</code> commands that were remapped to <code>n</code> and <code>p</code> in Dired
buffers.  This had several downsides, namely, (i) the other motions
would not pick up the trigger, (ii) we would have to remap all
possible motions, and (iii) the code was needlessly complex.
</p>

<p>
Currently, we install a local hook in the post-command phase, which
will trigger a preview if the previous command was a Dired motion.  In
future versions, we may expand the list of commands that we check for.
</p>

<p>
Thanks to Peter Prevos for reporting this in issue 1 on the GitHub
mirror: <a href="https://github.com/protesilaos/dired-preview/issues/1">https://github.com/protesilaos/dired-preview/issues/1</a>.
</p>

<p>
Thanks to Christian Tietze and Ed Hamilton for discussing this topic
with me on the mailing list:
<a href="https://lists.sr.ht/~protesilaos/general-issues/%3Cm1zg4noej2.fsf%40christiantietze.de%3E">https://lists.sr.ht/~protesilaos/general-issues/%3Cm1zg4noej2.fsf%40christiantietze.de%3E</a>.
Commit ae93720 by Christian Tietze is based on this discussion,
although the implementation details have since been redone.
</p>

<p>
During the development phase, I had made the mistake of checking the
<code>last-command</code>, whereas I should be testing against the
<code>this-command</code>.  Thanks to Karthik Chikmagalur for pointing out my
error:
<a href="https://lists.sr.ht/~protesilaos/general-issues/%3C87sfab8ixn.fsf%40gmail.com%3E">https://lists.sr.ht/~protesilaos/general-issues/%3C87sfab8ixn.fsf%40gmail.com%3E</a>.
</p>
</div>
</div>

<div id="outline-container-h:3033401f-878d-4298-9256-228d6c249b3a" class="outline-3">
<h3 id="h:3033401f-878d-4298-9256-228d6c249b3a">The placement of the preview window is customisable</h3>
<div class="outline-text-3" id="text-h:3033401f-878d-4298-9256-228d6c249b3a">
<p>
We arrange to display previews in a side window.  Due to the inherent
complexity of the <code>display-buffer</code> function and its accoutrements, a
user option is necessarily reserved for experienced users.  To this
end, we provide the <code>dired-preview-display-action-alist-function</code>.
Refer to the <code>dired-preview-display-action-alist-dwim</code> function for
the implementation details.
</p>

<p>
Thanks to Karthik Chikmagalur for making an initial suggestion about
such a feature:
<a href="https://lists.sr.ht/~protesilaos/general-issues/%3C87jzvp484n.fsf%40gmail.com%3E">https://lists.sr.ht/~protesilaos/general-issues/%3C87jzvp484n.fsf%40gmail.com%3E</a>
</p>

<p>
Thanks to Bruno Boal for discussing the user option and concomitant
function with me and for checking the relevant definitions.  This was
done via a private channel and the information is shared with
permission.
</p>
</div>
</div>

<div id="outline-container-h:06e6249d-8755-450e-b65e-b8f999d982a4" class="outline-3">
<h3 id="h:06e6249d-8755-450e-b65e-b8f999d982a4">Window placement and deletion is more robust</h3>
<div class="outline-text-3" id="text-h:06e6249d-8755-450e-b65e-b8f999d982a4">
<p>
The idea of "preview" windows is that they are not ordinary windows
that the user can interact with.  As such, they are to be deleted when
some non-preview mode of action is taken.
</p>

<p>
Testing for such cases was extensive and required lots of changes to
the code base.  Thanks to Bruno Boal for performing the tests with me,
for brainstorming possible solutions, and for inspecting the
implementation details.  This was done via a private channel and the
information is shared with permission.
</p>
</div>
</div>

<div id="outline-container-h:a2ee3d09-7356-465c-8627-bdc56e9ec303" class="outline-3">
<h3 id="h:a2ee3d09-7356-465c-8627-bdc56e9ec303">We no longer try to preview irregular files</h3>
<div class="outline-text-3" id="text-h:a2ee3d09-7356-465c-8627-bdc56e9ec303">
<p>
Before, <code>dired-preview</code> would attempt to produce a preview of named
pipes and sockets.  This was not intended and has since been
addressed.  Use 'file-regular-p' instead of 'file-exists-p'
</p>

<p>
Thanks to Karthik Chikmagalur for bringing this matter to my attention
and for recommending the use of <code>file-regular-p</code> instead of
<code>file-exists-p</code>:
<a href="https://lists.sr.ht/~protesilaos/general-issues/%3C87pm5cnpaf.fsf%40gmail.com%3E">https://lists.sr.ht/~protesilaos/general-issues/%3C87pm5cnpaf.fsf%40gmail.com%3E</a>.
</p>
</div>
</div>

<div id="outline-container-h:d8ba0949-76b0-4d3a-b0f3-1bfb62280483" class="outline-3">
<h3 id="h:d8ba0949-76b0-4d3a-b0f3-1bfb62280483">Preview buffers are killed up to a cumulative size threshold</h3>
<div class="outline-text-3" id="text-h:d8ba0949-76b0-4d3a-b0f3-1bfb62280483">
<p>
In the original design, we were killing preview buffers all at once.
This was wasteful because all the work we were doing in the background
to, for example, fetch a large file was discarded even though the user
could theoretically request another preview of it.
</p>

<p>
The current approach is to keep around the newer buffers in order to
speed up potential requests for another preview.  Older buffers are
discarded starting from the oldest.  The clearance of older buffers is
done until we reach a cumulative size of what is specified as the
value of the variable <code>dired-preview--buffers-threshold</code>.
</p>

<p>
Note that the symbol includes double dashes, meaning that it is
intended for "private" (internal) purposes.  I am mentioning it here,
because this seems like a good candidate for a future user option,
subject to further refinements.
</p>

<p>
Thanks to Bruno Boal for suggesting this idea and checking its
implementation with me.  This was done via a private channel and the
information is shared with permission.
</p>
</div>
</div>
</div>
