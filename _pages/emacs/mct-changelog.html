---
layout: page
title: 'Change Log of the Minibuffer and Completions in Tandem (MCT)'
excerpt: "The Minibuffer and Completions in Tandem (MCT) package provides enhancements to the default minibuffer completion UI."
permalink: /emacs/mct-changelog
---

<p>
This document contains the release notes that are included in each
tagged commit on the project's main git repository:
<a href="https://gitlab.com/protesilaos/mct">https://gitlab.com/protesilaos/mct</a>.
</p>

<p>
The newest release is at the top.  For further details, please consult
the manual: <a href="https://protesilaos.com/emacs/mct">https://protesilaos.com/emacs/mct</a>.
</p>

<div id="outline-container-h:c8d8ad3a-06c9-445d-a4e7-11a68ee17df1" class="outline-2">
<h2 id="h:c8d8ad3a-06c9-445d-a4e7-11a68ee17df1">Version 0.5.0 on 2022-02-08</h2>
<div class="outline-text-2" id="text-h:c8d8ad3a-06c9-445d-a4e7-11a68ee17df1">
<p>
This entry covers the changes made to the "Minibuffer and Completions in
Tandem" (<code>mct</code> package) since the release of <a href="#h:1f8fc960-4e4b-4bb1-a1c4-5083f287a28c">version 0.4.0 on 2022-01-19</a>.
There have been about 60 commits in the meantime.
</p>

<p>
For further details on the user-facing options covered herein, please
read the manual: <a href="https://protesilaos.com/emacs/mct">https://protesilaos.com/emacs/mct</a>.  Or evaluate the
following expression if you already have <code>mct</code> installed:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(info "(mct) Top")
</pre>
</div>
</div>

<div id="outline-container-h:95aca1ab-ce8a-4187-94ee-430d44a321b1" class="outline-3">
<h3 id="h:95aca1ab-ce8a-4187-94ee-430d44a321b1">Customisation options</h3>
<div class="outline-text-3" id="text-h:95aca1ab-ce8a-4187-94ee-430d44a321b1">
</div>

<div id="outline-container-h:1b49d3f4-be28-4c6e-a1cb-a473eb87f611" class="outline-4">
<h4 id="h:1b49d3f4-be28-4c6e-a1cb-a473eb87f611">Size of the Completions buffer</h4>
<div class="outline-text-4" id="text-h:1b49d3f4-be28-4c6e-a1cb-a473eb87f611">
<p>
The user option <code>mct-completion-window-size</code> controls the maximum and
minimum height of the window where the <code>*Completions*</code> buffer is shown.
It accepts a cons cell in the form of <code>(MAX-HEIGHT . MIN-HEIGHT)</code>.  Valid
values are natural numbers (positive integers) or functions which return
such numbers.  The default is a combination of the two for the sake of
illustration:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(setq mct-completion-window-size (cons #'mct--frame-height-fraction 1))
</pre>
</div>

<p>
With this in place, mct will let the <code>*Completions*</code> grow up to 1/3 of the
frame's height (per the <code>mct--frame-height-fraction</code>).  When live
completion is performed (see the user option <code>mct-live-completion</code>), the
window will shrink to fit the candidates.
</p>

<p>
To make the <code>*Completions*</code> have a fixed height instead, simply set the
same number/function twice.
</p>

<p>
If set to nil, mct will simply not try to fit the Completions' buffer to
its window.
</p>

<p>
Thanks to Daniel Mendler for the feedback in issue 14:
<a href="https://gitlab.com/protesilaos/mct/-/issues/14">https://gitlab.com/protesilaos/mct/-/issues/14</a>.
</p>
</div>
</div>

<div id="outline-container-h:cc1102ca-0a3f-4b34-84e0-c5d684a4c37e" class="outline-4">
<h4 id="h:cc1102ca-0a3f-4b34-84e0-c5d684a4c37e">Passlist and blocklist accept completion categories</h4>
<div class="outline-text-4" id="text-h:cc1102ca-0a3f-4b34-84e0-c5d684a4c37e">
<p>
The user options <code>mct-completion-passlist</code> and <code>mct-completion-blocklist</code>
used to only match symbols of commands like <code>find-file</code>, whereas now they
can affect any completion category such as <code>file</code>, <code>kill-ring</code>, et cetera.
</p>

<p>
Sample code:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">;; This is for commands or completion categories that should always pop
;; up the completions' buffer.  It circumvents the default method of
;; waiting for some user input (see `mct-minimum-input') before
;; displaying and updating the completions' buffer.
(setq mct-completion-passlist
      '(;; Some commands
        Info-goto-node
        Info-index
        Info-menu
        vc-retrieve-tag
        ;; Some completion categories
        imenu
        file
        buffer
        kill-ring
        consult-location))
</pre>
</div>

<p>
The manual provides a comprehensive list of known completion categories:
<a href="https://protesilaos.com/emacs/mct#h:1f42c4e6-53c1-4e8a-81ef-deab70822fa4">https://protesilaos.com/emacs/mct#h:1f42c4e6-53c1-4e8a-81ef-deab70822fa4</a>.
</p>

<p>
Or evaluate:
</p>

<pre class="example">
(info "(mct) Known completion categories")
</pre>
</div>
</div>

<div id="outline-container-h:21788d38-c916-4a36-93fd-6695776d954f" class="outline-4">
<h4 id="h:21788d38-c916-4a36-93fd-6695776d954f">Persist live completion for dynamic completion tables</h4>
<div class="outline-text-4" id="text-h:21788d38-c916-4a36-93fd-6695776d954f">
<p>
Quoting from the documentation of the <code>mct-persist-dynamic-completion</code>
user option:
</p>

<blockquote>
<p>
When non-nil, keep dynamic completion live.
</p>

<p>
Without any intervention from MCT, the default Emacs behavior for
commands such as <code>find-file</code> or for a <code>file</code> completion category is to hide
the <code>*Completions*</code> buffer after updating the list of candidates in a
non-exiting fashion (e.g. select a directory and expect to continue
typing the path).  This, however, runs contrary to the interaction model
of MCT when it performs live completions, because the user expects the
Completions' buffer to remain visible while typing out the path to the
file.
</p>

<p>
When this user option is non-nil (the default) it makes all non-exiting
commands keep the <code>*Completions*</code> visible when updating the list of
candidates.
</p>

<p>
This applies to prompts in the <code>file</code> completion category whenever the
user selects a candidate with <code>mct-choose-completion-no-exit</code>,
<code>mct-edit-completion</code>, <code>minibuffer-complete</code>, <code>minibuffer-force-complete</code>
(i.e. any command that does not exit the minibuffer).
</p>

<p>
The two exceptions are (i) when the current completion session runs a
command or category that is blocked by the <code>mct-completion-blocklist</code> or
(ii) the user option <code>mct-live-completion</code> is nil.
</p>

<p>
The underlying rationale:
</p>

<p>
Most completion commands present a flat list of candidates to choose
from.  Picking a candidate concludes the session.  Some prompts,
however, can recalculate the list of completions based on the selected
candidate.  A case in point is <code>find-file</code> (or any command with the <code>file</code>
completion category) which dynamically adjusts the completions to show
only the elements which extend the given file system path.  We call such
cases "dynamic completion".  Due to their particular nature, these need
to be handled explicitly.  The present user option is provided primarily
to raise awareness about this state of affairs.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-h:3f04e53d-c0bf-481e-861d-46511ef37265" class="outline-4">
<h4 id="h:3f04e53d-c0bf-481e-861d-46511ef37265">Deprecation of mct-region-completions-format</h4>
<div class="outline-text-4" id="text-h:3f04e53d-c0bf-481e-861d-46511ef37265">
<p>
The <code>mct-region-completions-format</code> used to be the only user option that
affected the <code>mct-region-mode</code>.  It was removed in the interest of
simplicity and to avoid potential complications or bugs.  Having
separate user options for <code>mct-minibuffer-mode</code> and <code>mct-region-mode</code> would
inevitably lead to duplication and a considerable expansion of the code
base with all sorts of exceptions and checks.
</p>

<p>
In-buffer completion now uses the same <code>mct-completions-format</code> as its
minibuffer-based counterpart.
</p>
</div>
</div>

<div id="outline-container-h:e40c90cc-3d65-4623-80fc-160df5cb540b" class="outline-4">
<h4 id="h:e40c90cc-3d65-4623-80fc-160df5cb540b">Deprecation of regexp for name of Completions</h4>
<div class="outline-text-4" id="text-h:e40c90cc-3d65-4623-80fc-160df5cb540b">
<p>
There used to be a user option <code>mct-completion-windows-regexp</code> which
targeted the name of the <code>*Completions*</code> buffer.  This was legacy code
from the early days of the code base: there is no reason to provide a
customisation of this sort.  The <code>defcustom</code> has been converted into a
<code>defvar</code> so anyone who still needs the feature can access it:
<code>mct--completions-window-name</code>.
</p>
</div>
</div>
</div>

<div id="outline-container-h:4e7f9589-a5c0-426a-98ae-6e4c3ade6531" class="outline-3">
<h3 id="h:4e7f9589-a5c0-426a-98ae-6e4c3ade6531">Sorting the completions on Emacs 29</h3>
<div class="outline-text-3" id="text-h:4e7f9589-a5c0-426a-98ae-6e4c3ade6531">
<p>
Starting with commit <code>a46421446f</code> to emacs.git (by me) users have the
option to control how the completions are sorted: the variable is
<code>completions-sort</code>.  Its default value is the same as before, namely, a
lexicographic order, though it accepts an arbitrary function.
</p>

<p>
The mct manual provides samples of such functions (improvements are
always welcome):
<a href="https://protesilaos.com/emacs/mct#h:493922c7-efdc-4b63-aa96-b31c684eb4fa">https://protesilaos.com/emacs/mct#h:493922c7-efdc-4b63-aa96-b31c684eb4fa</a>.
</p>

<p>
Or evaluate:
</p>

<pre class="example">
(info "(mct) Sort completion candidates on Emacs 29")
</pre>


<p>
For your convenience:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">;; Some sorting functions...
(defun my-sort-by-alpha-length (elems)
  "Sort ELEMS first alphabetically, then by length."
  (sort elems (lambda (c1 c2)
                (or (string-version-lessp c1 c2)
                    (&lt; (length c1) (length c2)))))))

(defun my-sort-by-history (elems)
  "Sort ELEMS by minibuffer history.
Use `mct-sort-sort-by-alpha-length' if no history is available."
  (if-let ((hist (and (not (eq minibuffer-history-variable t))
                      (symbol-value minibuffer-history-variable))))
      (minibuffer--sort-by-position hist elems)
    (my-sort-by-alpha-length elems)))

(defun my-sort-multi-category (elems)
  "Sort ELEMS per completion category."
  (pcase (mct--completion-category)
    ('nil elems) ; no sorting
    ('kill-ring elems)
    ('project-file (my-sort-by-alpha-length elems))
    (_ (my-sort-by-history elems))))

;; Specify the sorting function.
(setq completions-sort #'my-sort-multi-category)
</pre>
</div>

<p>
Remember to check the manual for all known completion categories.
</p>
</div>
</div>

<div id="outline-container-h:e0a18893-eaa7-4805-baa4-b238ac80f2ad" class="outline-3">
<h3 id="h:e0a18893-eaa7-4805-baa4-b238ac80f2ad">Changes to the manual</h3>
<div class="outline-text-3" id="text-h:e0a18893-eaa7-4805-baa4-b238ac80f2ad">
<ul class="org-ul">
<li>The documentation has been overhauled to better present its
contents. User options now have a parent section while each of them
occupies its own node, making it easier to find exactly what one
needs.</li>

<li>There is a workaround on how to circumvent the known issue where
<code>global-hl-line-mode</code> overrides the mct highlight.  Thanks to Tomasz
Hołubowicz for the feedback in issue 1 over at the GitHub mirror:
<a href="https://github.com/protesilaos/mct/issues/1">https://github.com/protesilaos/mct/issues/1</a>.</li>

<li>A node is included which explains that mct uses the remap mechanism
for specifying key bindings when it is appropriate.  As this can lead
to unexpected issues in certain user configurations, the manual
explains how to resolve any conflict.  Thanks to Daniel Mendler for
the feedback on the matter (done in various threads).</li>

<li>Users of both <code>mct</code> and <code>corfu</code> packages may experience a conflict.
Daniel Mendler (Corfu's developer) provided a snippet which is covered
in the Corfu's README as well as the mct manual on how to address the
potential issue: <a href="https://gitlab.com/protesilaos/mct/-/issues/16">https://gitlab.com/protesilaos/mct/-/issues/16</a>.</li>

<li>The <code>emacs-mct</code> package for Guix is now covered in the section about
installing mct.  Thanks to Andrew Tropin and Nicolas Goaziou for
making it happen: <a href="https://issues.guix.gnu.org/53812">https://issues.guix.gnu.org/53812</a>.</li>
</ul>
</div>
</div>

<div id="outline-container-h:688a7b6e-683c-4687-b6b7-2f7227eee1fb" class="outline-3">
<h3 id="h:688a7b6e-683c-4687-b6b7-2f7227eee1fb">Bug fixes and other refinements</h3>
<div class="outline-text-3" id="text-h:688a7b6e-683c-4687-b6b7-2f7227eee1fb">
<ul class="org-ul">
<li>The timer which controls when the Completions' buffer is displayed or
updated now cancels any outdated constructs instead of creating new
ones.  In other words, it is optimised.  Thanks to Daniel Mendler for
the patch which was sent via email and is recorded as commit <code>4ce1004</code>.</li>

<li>Version <code>0.4.1</code> fixed a regression with an out-of-bounds motion when
performing certain motions in the <code>*Completions*</code> with a numeric
argument.</li>

<li>Version <code>0.4.2</code> addressed a regression where <code>mct-region-mode</code> would fail
to perform live updates.  Thanks to Z.Du for reporting the bug in
issue 17: <a href="https://gitlab.com/protesilaos/mct/-/issues/17">https://gitlab.com/protesilaos/mct/-/issues/17</a>.</li>

<li>Motions in the Completions buffer are now always based on the
candidate rather than the line.  The old design would fail to identify
the first (topmost) candidate if its text was prefixed by entries that
were not part of the completion table, such as icons provided by the
<code>all-the-icons-completion</code> package.</li>

<li>The command <code>mct-keyboard-quit-dwim</code> (bound to <code>C-g</code> by default) now works
properly with the <code>mct-region-mode</code>.  Thanks to James Norman Vladimir
Cash for the contribution in merge request 5:
<a href="https://gitlab.com/protesilaos/mct/-/merge_requests/5">https://gitlab.com/protesilaos/mct/-/merge_requests/5</a>.</li>

<li>The <code>mct-highlight-candidate</code> no longer hardcodes colour values and
instead inherits from the <code>highlight</code> face.  This makes things easier
for themes (if you use the <code>modus-themes</code> package (by me), mct is now
affected by the option <code>modus-themes-completions</code>).  Thanks to Tomasz
Hołubowicz for the side note about this face in issue 1 over at the
GitHub mirror: <a href="https://github.com/protesilaos/mct/issues/1">https://github.com/protesilaos/mct/issues/1</a>.</li>

<li>Cycling the completion candidates no longer fails when the one at
point consists of empty spaces and/or newlines.  Thanks to Tomasz
Hołubowicz for reporting the bug in issue 2 over at the GitHub mirror:
<a href="https://github.com/protesilaos/mct/issues/2">https://github.com/protesilaos/mct/issues/2</a>.</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-h:1f8fc960-4e4b-4bb1-a1c4-5083f287a28c" class="outline-2">
<h2 id="h:1f8fc960-4e4b-4bb1-a1c4-5083f287a28c">Version 0.4.0 on 2022-01-19</h2>
<div class="outline-text-2" id="text-h:1f8fc960-4e4b-4bb1-a1c4-5083f287a28c">
<p>
This entry outlines the changes to the "Minibuffer and Completions in
Tandem" (<code>mct</code> package) since the release of <a href="#h:902574cf-edf0-4182-9d34-5e8e28730193">version 0.3.0 on 2021-11-19</a>.
There have been more than 120 commits in the meantime.
</p>

<p>
For further details, please consult the manual online:
<a href="https://protesilaos.com/emacs/mct">https://protesilaos.com/emacs/mct</a>.  Or evaluate the following
expression if you already have <code>mct</code> installed:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(info "(mct) Top")
</pre>
</div>

<p>
As most changes pertain to optimisations in the code base, we limit this
log to what is of interest to the end-user.
</p>
</div>

<div id="outline-container-h:6ee71a37-cada-43af-93b3-a1d65e2be4a8" class="outline-3">
<h3 id="h:6ee71a37-cada-43af-93b3-a1d65e2be4a8">Minibuffer Confines Transcended (aka mct-region-mode)</h3>
<div class="outline-text-3" id="text-h:6ee71a37-cada-43af-93b3-a1d65e2be4a8">
<p>
Emacs distinguishes between two types of completion: one that involves
the minibuffer and another for text expansion inside regular buffers.
MCT has supported the former case since its inception, as hinted by its
original name ("Minibuffer and Completions in Tandem"), but would not
work as intended for in-buffer completion.
</p>

<p>
This changes with the introduction of a new global minor mode:
<code>mct-region-mode</code>.  What once was <code>mct-mode</code> is now defined as
<code>mct-minibuffer-mode</code> to better denote the scope of the given
functionality.
</p>

<p>
With <code>mct-region-mode</code> enabled, users get a simplified subset of the
familiar MCT functionality when typing <code>TAB</code> or <code>C-M-i</code> to complete the
text-at-point in any major-mode that supports
<code>completion-at-point-functions</code> (e.g. programming modes or Org).
</p>

<p>
<code>mct-region-mode</code> is considered experimental and unstable.  Users are
encouraged to report any bugs as well as recommend ways to improve its
functionality or interaction model.  The manual has been updated to
cover all the relevant details.
</p>

<p>
Daniel Mendler, who is the developer of the <code>vertico</code> and <code>corfu</code> packages
(alternatives to <code>mct-minibuffer-mode</code> and <code>mct-region-mode</code>, respectively),
was intstrumental in making <code>mct-region-mode</code> happen.  Daniel's patches
helped with everything from (i) the proper functioning of
<code>mct-region-mode</code>, (ii) the separation between <code>mct-minibuffer-mode</code> and
<code>mct-region-mode</code>, (iii) the overall setup of the minor modes, and (iv)
lots of other crucial details of the overall design of MCT.  In short:
there would be no <code>mct-region-mode</code> without Daniel's contributions.  Any
remaining errors or omissions are my own.
</p>

<p>
Given this new functionality, we can now joke that "MCT" stands for
"Minibuffer Confines Transcended".
</p>
</div>
</div>
</div>

<div id="outline-container-h:902574cf-edf0-4182-9d34-5e8e28730193" class="outline-2">
<h2 id="h:902574cf-edf0-4182-9d34-5e8e28730193">Version 0.3.0 on 2021-11-19</h2>
<div class="outline-text-2" id="text-h:902574cf-edf0-4182-9d34-5e8e28730193">
<p>
This entry describes the changes to Minibuffer and Completions in Tandem
(mct) since the release of <a href="#h:4fab7648-d672-4af3-90b5-74242292f633">version 0.2.0 on 2021-11-12</a>.  There have been
more than 40 commits since then.  For further details, please consult
the manual online: <a href="https://protesilaos.com/emacs/mct">https://protesilaos.com/emacs/mct</a>.  Or evaluate
the following expression if you have the <code>mct</code> package installed:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(info "(mct) Top")
</pre>
</div>

<p>
As this release is a continuation of version <code>0.2.0</code>, the changelog for
that version is also provided below (I released version <code>0.2.0</code> earlier
than anticipated so that users could get a stable package on GNU ELPA).
Here is a brief description of what has been achieved in <code>0.3.0</code>.
</p>
</div>

<div id="outline-container-h:c05100f7-a525-4d76-8f88-8de4cfe69e67" class="outline-3">
<h3 id="h:c05100f7-a525-4d76-8f88-8de4cfe69e67">MCT on Emacs 27</h3>
<div class="outline-text-3" id="text-h:c05100f7-a525-4d76-8f88-8de4cfe69e67">
<ul class="org-ul">
<li>MCT now works on Emacs 27.  This was not possible in the past because
<code>mct-mode</code> was originally designed to operate with the <code>one-column</code> style
of the <code>completions-format</code>, which was added in Emacs 28.  To make
everything behave intuitively, several parts had to be abstracted and
refactored (the changelog of version <code>0.2.0</code> (further below) covers
everything not mentioned here).</li>

<li>The scenaria where the functionality was thoroughly tested involve all
the available formats and cover commands that fulfil the following
criteria:

<ul class="org-ul">
<li>Plain completion candidates, as in <code>switch-to-buffer</code>.</li>
<li>Dynamic completion like that of <code>find-file</code>.</li>
<li>Annotated candidates, as seen in <code>describe-symbol</code> for versions of
Emacs 28 or higher.</li>
<li>Commands where candidates are grouped by heading, as done by various
extensions of the <code>consult</code> package, such as <code>consult-imenu</code>.</li>
<li>Commands where no completion category is associated with them.</li>
</ul></li>

<li>The only change which is visible to the user is the implementation
of a bespoke overlay to highlight the current candidate.  In
previous versions, this was provided by the built-in <code>hl-line-mode</code>,
though that does not work as intended with either the <code>vertical</code> or
<code>horizontal</code> layouts of the <code>completions-format</code> as it covers the whole
line instead of the candidate at point.</li>

<li>The highlight extends to the edge of the window when the <code>one-column</code>
format is used for the <code>completions-format</code> (Emacs 28 or higher).  In
the other views it stretches from the beginning to the end of the
completion candidate.</li>

<li>Thanks to Case Duckworth for the initial request and subsequent
testing in issue 1: <a href="https://gitlab.com/protesilaos/mct/-/issues/1">https://gitlab.com/protesilaos/mct/-/issues/1</a>.</li>
</ul>
</div>
</div>

<div id="outline-container-h:db448e8b-5416-4561-993a-4f5f3a8ad7e4" class="outline-3">
<h3 id="h:db448e8b-5416-4561-993a-4f5f3a8ad7e4">Miscellaneous changes</h3>
<div class="outline-text-3" id="text-h:db448e8b-5416-4561-993a-4f5f3a8ad7e4">
<ul class="org-ul">
<li>There is a new command that is active in the minibuffer which allows
to complete and exit immediately: <code>C-RET</code> (<code>mct-complete-and-exit</code>).  This
economises on key presses when all the user wants is to select the
top-most candidate (or last highlighted one) without first switching
to the Completions' buffer and then confirming it from there (<code>RET</code> in
the <code>*Completions*</code> buffer completes and exits directly).

<ul class="org-ul">
<li>Thanks to José Antonio Ortega Ruiz for the contribution in merge
requests 3 and 4 as discussed in issue 8:

<ul class="org-ul">
<li><a href="https://gitlab.com/protesilaos/mct/-/merge_requests/3">https://gitlab.com/protesilaos/mct/-/merge_requests/3</a></li>
<li><a href="https://gitlab.com/protesilaos/mct/-/merge_requests/4">https://gitlab.com/protesilaos/mct/-/merge_requests/4</a></li>
<li><a href="https://gitlab.com/protesilaos/mct/-/issues/8">https://gitlab.com/protesilaos/mct/-/issues/8</a></li>
</ul></li>

<li>Note that "exit" in this context denotes the process of terminating
the session while accepting the current input.  The term used to
quit without accepting the input is "abort".</li>
</ul></li>

<li>The <code>mct-mode</code> does not get activated in contexts where (i) the
minibuffer is involved but (ii) no completion takes place.  For
example, the <code>eval-expression</code> command (bound to <code>M-:</code> by default).</li>

<li><code>mct-mode</code> no longer remaps the faces of the <code>display-line-numbers-mode</code>.
This was a useful experiment from the early days of the code base,
although it is bad practice for a user-facing package.</li>

<li>Various tweaks and refinements to the manual.</li>

<li>Retroactive introduction of a CHANGELOG.org file and coverage of all
noteworthy changes hitherto.</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-h:4fab7648-d672-4af3-90b5-74242292f633" class="outline-2">
<h2 id="h:4fab7648-d672-4af3-90b5-74242292f633">Version 0.2.0 on 2021-11-12</h2>
<div class="outline-text-2" id="text-h:4fab7648-d672-4af3-90b5-74242292f633">
<p>
This entry describes the changes to Minibuffer and Completions in Tandem
(mct) since the release of <a href="#h:a4b2152a-96e2-46fc-b9e0-ba223028118f">version 0.1.0 on 2021-10-22</a>.  There have been
70 commits since then.  For further details, please consult the manual
online: <a href="https://protesilaos.com/emacs/mct">https://protesilaos.com/emacs/mct</a>.  Or evaluate the following
expression if you have the <code>mct</code> package installed:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(info "(mct) Top")
</pre>
</div>
</div>

<div id="outline-container-h:0fb1fb23-636f-41f3-97bf-880d83ac42e0" class="outline-3">
<h3 id="h:0fb1fb23-636f-41f3-97bf-880d83ac42e0">Packaged version of MCT</h3>
<div class="outline-text-3" id="text-h:0fb1fb23-636f-41f3-97bf-880d83ac42e0">
<p>
<code>mct</code> is now available on the official GNU ELPA archive for users of Emacs
version 28 or higher.  One can install the package without any further
configuration.  The following commands shall suffice:
</p>

<pre class="example">
M-x package-refresh-contents
M-x package-install RET mct
</pre>
</div>
</div>

<div id="outline-container-h:97eba994-45ad-4f86-945f-a60772f764b5" class="outline-3">
<h3 id="h:97eba994-45ad-4f86-945f-a60772f764b5">Changes to the format and placement of the Completions</h3>
<div class="outline-text-3" id="text-h:97eba994-45ad-4f86-945f-a60772f764b5">
<ul class="org-ul">
<li><p>
The user option <code>mct-live-completion</code> controls how and when the
Completions' buffer should be placed in a window and be updated live
in response to user feedback.  Copying from the doc string:
</p>

<blockquote>
<p>
mct-live-completion is a variable defined in ‘mct.el’.
</p>

<p>
Its value is t
</p>

<p>
Control auto-display and live-update of Completions' buffer.
</p>

<p>
When nil, the user has to manually request completions, using the
regular activating commands.  The Completions' buffer is never updated
live to match user input.  Updating has to be handled manually.  This
is like the out-of-the-box minibuffer completion experience.
</p>

<p>
When set to the value <code>visible</code>, the Completions' buffer is live
updated only if it is visible.  The actual display of the completions
is still handled manually.  For this reason, the <code>visible</code> style does
not read the <code>mct-minimum-input</code>, meaning that it will always try to
live update the visible completions, regardless of input length.
</p>

<p>
When non-nil (the default), the Completions' buffer is automatically
displayed once the <code>mct-minimum-input</code> is met and is hidden if the
input drops below that threshold.  While visible, the buffer is
updated live to match the user input.
</p>

<p>
Note that every function in the <code>mct-completion-passlist</code> ignores this
option altogether.  This means that every such command will always
show the Completions' buffer automatically and will always update its
contents live.  Same principle for every function declared in the
<code>mct-completion-blocklist</code>, which will always disable both the
automatic display and live updating of the Completions' buffer.
</p>
</blockquote>

<ul class="org-ul">
<li>Thanks to Jonathan Irving for the feedback in issue 4:
<a href="https://gitlab.com/protesilaos/mct/-/issues/4">https://gitlab.com/protesilaos/mct/-/issues/4</a>.</li>
</ul></li>

<li>As with all buffers, the placement of the <code>*Completions*</code> can be
controlled with the <code>display-buffer</code> machinery.  The default is to show
the completions at the bottom of the frame, though users can easily
move it to, say, the left side window.  The doc string of the user
option <code>mct-display-buffer-action</code> explains how to do so.

<ul class="org-ul">
<li>Thanks to Philip Kaludercic for the initial implementation in commit
<code>436b24e</code> (was sent via email as a patch).</li>

<li>Thanks to Kostadin Ninev for reporting a bug where the Completions'
buffer would proliferate during completion:
<a href="https://gitlab.com/protesilaos/mct/-/issues/3">https://gitlab.com/protesilaos/mct/-/issues/3</a>.  It was fixed by
Philip Kaludercic in commit <code>51c1e17</code>.</li>
</ul></li>

<li>MCT now supports all the available styles of the <code>completions-format</code>,
whereas the original design was only meant to work with the value
<code>one-column</code>, which was introduced in Emacs 28.  The user option is
<code>mct-completions-format</code>.  If that variable is set with <code>setq</code>, the
<code>mct-mode</code> has to be restarted manually for changes to take effect
(setting the variable through <code>customize-set-variable</code> (and related)
handles the mode reloading automatically).

<ul class="org-ul">
<li>Thanks to Philip Kaludercic for the patch in commit <code>b392b0b</code>.</li>

<li>Several changes were then made to ensure that the cyclic motions
that move between the <code>*Completions*</code> and the minibuffer work
intuitively in a grid view.  In short: <code>C-n</code>, <code>C-p</code> or the down/up arrow
keys, perform a vertical motion, while the left/right arrow keys
move laterally.  Prior to those changes, <code>C-n</code> or down arrow as well
as <code>C-p</code> or up arrow, would perform a lateral motion as that is
internally the meaning of the next/previous completion candidate.</li>

<li>The command <code>mct-choose-completion-number</code> was updated to throw a user
error when a grid view is active.  That is because it is designed to
jump to a given line number, which only works as intended when there
is only one candidate per line. (Perhaps a future release should
overlay characters over candidates in the grid view to select them
directly.)</li>
</ul></li>

<li>The <code>mct-mode</code> no longer sets the <code>completions-detailed</code> variable.  That
is a matter of user preference.  It is not integral to the
functionality of MCT.</li>
</ul>
</div>
</div>

<div id="outline-container-h:5f9027f9-fad0-4c03-8269-60eb670d0b38" class="outline-3">
<h3 id="h:5f9027f9-fad0-4c03-8269-60eb670d0b38">Group motions</h3>
<div class="outline-text-3" id="text-h:5f9027f9-fad0-4c03-8269-60eb670d0b38">
<ul class="org-ul">
<li>Emacs 28 provides infrastructure for commands to group candidates
based on their contents.  These groups can have their own heading in
the Completions' buffer, as well as a separator.  Overall, it makes
things look more organised.  The commands <code>mct-next-completion-group</code>
and <code>mct-previous-completion-group</code> move between those headings.  While
in the <code>*Completions*</code> buffer, they are bound to <code>M-n</code> and <code>M-p</code>,
respectively.  Thanks to James Norman Vladimir Cash for the
contribution in merge request 2:
<a href="https://gitlab.com/protesilaos/mct/-/merge_requests/2">https://gitlab.com/protesilaos/mct/-/merge_requests/2</a>.</li>
</ul>
</div>
</div>

<div id="outline-container-h:ed67abef-dad3-4620-bc70-1c3dc268db59" class="outline-3">
<h3 id="h:ed67abef-dad3-4620-bc70-1c3dc268db59">Miscellaneous changes</h3>
<div class="outline-text-3" id="text-h:ed67abef-dad3-4620-bc70-1c3dc268db59">
<ul class="org-ul">
<li><p>
The <code>TAB</code> key in the Completions' buffer never exits the minibuffer (the
command is <code>mct-choose-completion-no-exit</code>).  Instead, it expands the
current candidate in the minibuffer and switches focus to it.  Before,
this behaviour would only happen in <code>find-file</code> and related prompts, but
consistency/predictability is better.
</p>

<p>
[ By contrast, <code>RET</code> (<code>mct-choose-completion-exit</code>) in the Completions
  buffer always exits with the candidate at point. ]
</p>

<p>
Note that in this context "exit" means to close the session and accept
the current input.
</p></li>

<li>There is a new heuristic to deal with commands that <code>let</code> bind the
<code>crm-separator</code> (e.g. <code>org-set-tags-command</code> sets the separator to <code>:</code>).
This is used to make <code>M-RET</code> (<code>mct-choose-completion-dwim</code>) in the
Completions buffer work in all <code>completing-read-multiple</code> contexts.
Thanks to James Norman Vladimir Cash for contributing the heuristic in
merge request 1:
<a href="https://gitlab.com/protesilaos/mct/-/merge_requests/1">https://gitlab.com/protesilaos/mct/-/merge_requests/1</a>.</li>

<li>The aforementioned <code>M-RET</code> command used to have the same effect as <code>RET</code>
when not in a <code>completing-read-multiple</code> prompt ("CRM prompt").  This
has now been revised to behave like <code>TAB</code> instead (as described further
above), which is consistent with the ordinary behaviour of <code>M-RET</code> in
CRM prompts where it appends the candidate at point to the minibuffer
without exiting.</li>

<li>The check for <code>display-line-numbers-mode</code> tests whether it is bound,
thus avoiding possible errors.  Thanks to Philip Kaludercic for the
patch in commit <code>6bd2457</code>.</li>

<li>Made several improvements to doc strings and various snippets of code.</li>
</ul>
</div>
</div>

<div id="outline-container-h:19c69838-c480-4b98-80e3-da25642a2c23" class="outline-3">
<h3 id="h:19c69838-c480-4b98-80e3-da25642a2c23">Updates to the manual</h3>
<div class="outline-text-3" id="text-h:19c69838-c480-4b98-80e3-da25642a2c23">
<ul class="org-ul">
<li>All of the aforementioned were documented, where appropriate.</li>
<li>A Makefile is now on offer, which is used to generate the mct.info and
mct.texi files.  Thanks to Philip Kaludercic for the patch in commit
<code>295bac0</code>.</li>
<li>A sample setup is available for <code>mct</code> as well as several built-in
options pertaining to the minibuffer.</li>
<li>There are sections about third-party extensions as well as one that
describes alternatives to MCT.  Thanks to Manuel Uberti for the
feedback in issue 5: <a href="https://gitlab.com/protesilaos/mct/-/issues/5">https://gitlab.com/protesilaos/mct/-/issues/5</a>.</li>
<li>The "Acknowledgements" section includes the names of people who have
contributed to the project in one way or another (code, ideas, user
feedback, &#x2026;).</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-h:a4b2152a-96e2-46fc-b9e0-ba223028118f" class="outline-2">
<h2 id="h:a4b2152a-96e2-46fc-b9e0-ba223028118f">Version 0.1.0 on 2021-10-22</h2>
<div class="outline-text-2" id="text-h:a4b2152a-96e2-46fc-b9e0-ba223028118f">
<p>
Initial release.  The mct.el file derived from the now-deprecated
prot-minibuffer.el (part of <a href="https://gitlab.com/protesilaos/dotfiles">my dotfiles</a>), which I had been using for
more than six months full time.
</p>
</div>
</div>
